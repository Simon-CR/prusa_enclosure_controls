# Prusament ABS - Enclosure Control Profile
# Based on Prusa Core ONE implementation

[filament:Prusament ABS - Enclosure]
inherits = Prusament ABS
compatible_printers_condition = printer_notes=~/.*HACKERBOARD.*/

# Prusa's actual temperatures for enclosed ABS
bed_temperature = 100
first_layer_bed_temperature = 100
temperature = 250
first_layer_temperature = 255

# Prusa's conservative cooling for enclosed ABS
cooling = 1
disable_fan_first_layers = 4
max_fan_speed = 20
min_fan_speed = 10
bridge_fan_speed = 25
top_fan_speed = 20

# Retraction settings for enclosed printing
retract_length = 0.8
retract_lift = 0.2
retract_speed = 40
deretract_speed = 30

# Start G-code with proper preheat wait
start_filament_gcode = ; Prusament ABS with Enclosure Control\n; Based on Prusa Core ONE specifications\n;\n; Heat bed first for passive chamber warming\nM140 S[first_layer_bed_temperature]\nM104 S170 ; Preheat nozzle for leveling\n;\n; Enable enclosure controller\nM117 Enclosure: ABS mode\nM262 P7 V1 ; Enable system\nM262 P6 V1 ; Profile bits = 101 (ABS)\nM262 P5 V0\nM262 P4 V1\n;\n; Wait for bed\nM190 S[first_layer_bed_temperature]\n;\n; Chamber preheat (35째C minimum, 40째C target)\nM117 Waiting for chamber 35C...\nM262 P2 V1 ; Request preheat\n;\n; Wait for chamber ready signal or timeout\n; The controller will set GPIO_STATUS_OK when ready\nG4 S600 ; Maximum 10 minute wait (active heating is faster)\n;\n; Standard start sequence\nM109 R170\nG28 ; Home\nG29 ; Mesh bed leveling\n;\n; Final nozzle heating\nM104 S[first_layer_temperature]\nM109 S[first_layer_temperature]\n;\n; Signal first layer protection\nM262 P2 V1 ; First layer mode\nM117 Printing ABS (Chamber 40C)

# End G-code with proper VOC purge
end_filament_gcode = ; ABS print complete\n;\n; Start VOC purge cycle (5 minutes per Prusa spec)\nM117 VOC purge (5 min)...\nM104 S0 ; Nozzle off\nM140 S0 ; Bed off\nM262 P3 V1 ; Start purge\nG4 S300 ; Wait 5 minutes\n;\n; Controlled cooldown\nM117 Controlled cooldown...\nM262 P2 V0 ; Normal mode\n; Let controller handle gradual cooling\n;\n; Final disable\nG4 S60 ; Extra minute\nM262 P7 V0 ; Disable enclosure\nM84 ; Motors off\nM117 Print complete

# Layer change G-code to track layers
layer_gcode = ; Layer [layer_num]\n{if layer_num==5}M262 P2 V0 ; End first layer protection{endif}

filament_notes = Chamber: 35째C minimum, 40째C target | First 4 layers protected | 5 min VOC purge